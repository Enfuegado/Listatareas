<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ToDo - Vue.js (Ejemplo)</title>
  <style>
    /* Ajustar estilos y colores */
    :root{ --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);} 
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin:0; background:linear-gradient(180deg,#071024 0%, #071426 60%); color:#e6eef8; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:32px}
    .container{width:100%; max-width:860px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:22px; box-shadow: 0 8px 30px rgba(2,6,23,0.6); backdrop-filter: blur(6px);}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted); font-size:13px}

    /* EL area de input */
    .input-row{display:flex; gap:10px; margin-top:18px}
    .input-row input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:15px}
    .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent); color:#032016; font-weight:600; cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04); color:var(--accent)}

    /* La lista */
    .list{margin-top:18px; display:flex; flex-direction:column; gap:8px}
    .todo{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:var(--glass); border:1px solid rgba(255,255,255,0.02)}
    .todo .title{flex:1}
    .todo .title p{margin:0;font-size:15px}
    .todo .meta{font-size:12px;color:var(--muted)}
    .todo.completed .title p{ text-decoration: line-through; opacity:0.5}
    .todo.completed{filter:grayscale(.05)}

    .controls{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}

    footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:12px}
    .filters{display:flex;gap:8px}

    /* Parte de adici√≥n de responsive */
    @media (max-width:520px){
      body{padding:16px}
      .input-row{flex-direction:column}
      .btn{width:100%}
      header{flex-direction:column;align-items:flex-start;gap:6px}
    }
  </style>
</head>
<body>
  <!--
    montaje de la app
    uso del todo input y del todo list
  -->
  <div id="app" class="container">
    <div class="card">
      <header>
        <div>
          <h1>Lista de tareas</h1>
          <div class="sub">Organizador de tareas</div>
        </div>
        <div class="sub">Tareas: <strong>{{ tareas.length }}</strong></div>
      </header>

      <!-- componente para entrada -->
      <entrada-tarea @agregar-tarea="agregarTarea"></entrada-tarea>

      <!-- filtros y el contador -->
      <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
        <div class="filters">
          <button class="btn ghost" :class="{active:filtro==='all'}" @click="filtro='all'">Todas</button>
          <button class="btn ghost" :class="{active:filtro==='active'}" @click="filtro='active'">Activas</button>
          <button class="btn ghost" :class="{active:filtro==='completed'}" @click="filtro='completed'">Completadas</button>
        </div>
        <div class="sub">Completadas: {{ contadorCompletadas }} </div>
      </div>

      <!-- Lista de tareas -->

      <lista-tareas :elementos="tareasFiltradas" @alternar="alternarTarea" @eliminar="eliminarTarea"></lista-tareas>

      <footer>
        <div class="sub">Cambios guardados localmente</div>
        <div style="display:flex;gap:8px">
          <button class="btn ghost" @click="borrarCompletadas">Borrar completadas</button>
          <button class="btn" @click="limpiarTodas">Limpiar todo</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Cargar el Vue 3 de CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>

    // Se usa la API global de Vue

    const { createApp, ref, computed } = Vue;


    // Componente: EntradaTarea
    //  -Parte para escribir tareas y enviarlas
    //  -Se usa el evento 'agregar-tarea' con el texto ya limpiado

    const EntradaTarea = {
      template: `
        <div class="input-row">
          <input v-model="texto" @keyup.enter="enviar" placeholder="A√±adir nueva tarea..." aria-label="A√±adir tarea" />
          <button class="btn" @click="enviar">Agregar</button>
        </div>
      `,
      data() { return { texto: '' } },
      methods: {
        enviar(){
          // Esta parte evitar a√±adir tareas vacias o solo con espacios
          const valor = this.texto && this.texto.trim();
          if(!valor) return;

          // Emitir el valor al componente padre
          this.$emit('agregar-tarea', valor);
          // Limpia la casilla del input
          this.texto = '';
        }
      }
    };

    // Componente: ItemTarea
    // - Representa una tarea individual
    // - Recibe 'tarea' como {id, text, done, createdAt}
    // - Genera los eventos 'alternar' (marcar/desmarcar) y 'eliminar'
 
    const ItemTarea = {
      props: ['tarea'],
      template: `
        <div class="todo" :class="{completed: tarea.done}">
          <input type="checkbox" :checked="tarea.done" @change="$emit('alternar', tarea.id)" aria-label="Marcar tarea" />
          <div class="title"><p>{{ tarea.text }}</p><div class="meta">Creada: {{ formatearFecha(tarea.createdAt) }}</div></div>
          <div class="controls">
            <button class="icon-btn" @click="$emit('eliminar', tarea.id)" title="Eliminar">üóëÔ∏è</button>
          </div>
        </div>
      `,
      methods: {
        formatearFecha(ts){

          // Convierte timestamp (hora actual) en cadena legible seg√∫n la hora local del navegador
          const d = new Date(ts);
          return d.toLocaleString();
        }
      }
    };


    // Componente: ListaTareas
    // -Recibe 'elementos' como array y renderiza un ItemTarea por cada elemento
    // -Re-emite los eventos del hijo hacia el padre para que la app principal los controle
  
    const ListaTareas = {
      props:['elementos'],
      components:{ 'tarea-item': ItemTarea },
      template:`
        <div class="list">
          <div v-if="elementos.length===0" class="sub" style="padding:12px">No hay tareas que mostrar.</div>
          <tarea-item v-for="t in elementos" :key="t.id" :tarea="t" @alternar="$emit('alternar', $event)" @eliminar="$emit('eliminar', $event)"></tarea-item>
        </div>
      `
    };


    // App principal
    // -Estado de tareas (array reactivo) y filtro (string)
    // -Persistencia simple de localStorage con la clave CLAVE_ALMACENAMIENTO
    // -Funciones: agregarTarea, alternarTarea, eliminarTarea, borrarCompletadas, limpiarTodas

    createApp({
      components:{ 'entrada-tarea': EntradaTarea, 'lista-tareas': ListaTareas },
      setup(){
        const CLAVE_ALMACENAMIENTO = 'vue_todo_example_v1';

        // Recupera tareas desde localStorage (o inicia vac√≠o)
        const tareas = ref(JSON.parse(localStorage.getItem(CLAVE_ALMACENAMIENTO) || '[]'));
        const filtro = ref('all');

        // guarda el arreglo actual en localStorage (serializa a JSON)
        const guardar = () => localStorage.setItem(CLAVE_ALMACENAMIENTO, JSON.stringify(tareas.value));

        // Agrega una nueva tarea (id unico, texto, estado y fecha)
        const agregarTarea = (texto) => {
          tareas.value.unshift({ id: Date.now().toString(36)+Math.random().toString(36).slice(2,6), text:texto, done:false, createdAt: Date.now() });
          guardar();
        };

        // Alterna el estado done de la tarea por id
        const alternarTarea = (id) => {
          const t = tareas.value.find(x=>x.id===id);
          if(t) t.done = !t.done;
          guardar();
        };

        //Elimina una tarea por id
        const eliminarTarea = (id) => {
          const idx = tareas.value.findIndex(x=>x.id===id);
          if(idx>-1) tareas.value.splice(idx,1);
          guardar();
        };
        // Elimina todas las tareas completadas
        const borrarCompletadas = () => {
          tareas.value = tareas.value.filter(t=>!t.done);
          guardar();
        };

        // Borra todas las tareas (pide confirmaci√≥n)
        const limpiarTodas = () => {
          if(!confirm('¬øBorrar todas las tareas?')) return;
          tareas.value = [];
          guardar();
        };

        // Computed: n√∫mero de tareas hechas
        const contadorCompletadas = computed(()=> tareas.value.filter(t=>t.done).length);

        // Computed: lista filtrada seg√∫n 'filtro'

        const tareasFiltradas = computed(()=>{
          if(filtro.value==='active') return tareas.value.filter(t=>!t.done);
          if(filtro.value==='completed') return tareas.value.filter(t=>t.done);
          return tareas.value;
        });

        // Exponer variables y funciones al template
        return { tareas, filtro, agregarTarea, alternarTarea, eliminarTarea, borrarCompletadas, limpiarTodas, contadorCompletadas, tareasFiltradas };
      }
    }).mount('#app');
  </script>
</body>
</html>
